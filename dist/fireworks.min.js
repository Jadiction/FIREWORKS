class FIREWORKS{constructor({full_screen:t=!1,target_node:i,amount:s=5}){this._set_inner_classes(),this.make_full=t,this.target_node=t?document.body:i,[this.W,this.H]=[t?window.innerWidth:i.clientWidth,t?window.innerHeight:i.clientHeight],this.GOLDEN_SPIRAL=Math.PI*(1+Math.sqrt(5)),this.PI_HALF=Math.PI/2,this.FIREWORKS_NUM=s,this.SPARKS_NUM_PER_FIREWORK=150,this.SPARKS_RADIUS=(this.W>this.H?this.H:this.W)/250,this.GRAVITY_RATIO_TO_HEIGHT=.05,this.GRAVITY=-this.H*this.GRAVITY_RATIO_TO_HEIGHT,this.COFFICIENT_OF_AIR_RESISTANCE=2,this.VELOCITY_RATIO_TO_WH=2/3,this.VELOCITY=(this.W>this.H?this.H:this.W)*this.VELOCITY_RATIO_TO_WH,this.LAUNCH_VELOCITY=this.H*this.VELOCITY_RATIO_TO_WH,this.STEP_INTERVAL=1/60,this.SPARK_TIME=2500,this.SLEEP_TIME=5e3,this.BACKGROUND="rgb(0,0,0)",this.RESIDUAL="rgba(0,0,0,0.1)",this.ctx=document.createElement("canvas").getContext("2d"),[this.ctx.canvas.width,this.ctx.canvas.height]=[this.W,this.H],this.clear(),t?FIREWORKS.set_full_screen():(this.ctx.canvas.style.margin=0,this.ctx.canvas.style.padding=0),this.target_node.appendChild(this.ctx.canvas),this.pixi=new PIXI.Application({resolution:1,antialias:!0,autoDensity:!0,transparent:!0}),this.pixi.renderer.resize(this.W,this.H),this.container=new PIXI.ParticleContainer(this.FIREWORKS_NUM*(4*this.SPARKS_NUM_PER_FIREWORK+1),{tint:!0}),this.pixi.stage.addChild(this.container),this.sparks=this.pixi.renderer.generateTexture((new PIXI.Graphics).beginFill(16777215,1).drawCircle(0,0,500).endFill()),this.fireworks=[...Array(this.FIREWORKS_NUM)].map(()=>new this.Firework);const e="ontouchend"in document?"orientationchange":"resize";this.timeout,window.addEventListener(e,()=>{clearTimeout(this.timeout),this.timeout=setTimeout(this.resize.bind(this),250)})}start_burst(){this.pixi.ticker.add(this.render.bind(this))}stop(){this.pixi.ticker.stop()}restart(){this.pixi.ticker.start()}clear(){this.ctx.fillStyle=this.BACKGROUND,this.ctx.fillRect(0,0,this.W,this.H),this.ctx.fillStyle=this.RESIDUAL}render(){this.ctx.fillRect(0,0,this.W,this.H);for(let t=0;t<this.FIREWORKS_NUM;t++)this.fireworks[t].update();this.ctx.drawImage(this.pixi.view,0,0)}resize(){requestAnimationFrame(()=>{[this.W,this.H]=[this.ctx.canvas.width,this.ctx.canvas.height]=[this.make_full?window.innerWidth:this.target_node.clientWidth,this.make_full?window.innerHeight:this.target_node.clientHeight],this.pixi.renderer.resize(this.W,this.H),this.GRAVITY=-this.H*this.GRAVITY_RATIO_TO_HEIGHT,this.VELOCITY=(this.W>this.H?this.H:this.W)*this.VELOCITY_RATIO_TO_WH,this.LAUNCH_VELOCITY=this.H*this.VELOCITY_RATIO_TO_WH,this.clear()})}_set_inner_classes(){const t=this;this.Coordinates=class{constructor(t=0,i=0,s=0){[this.x,this.y,this.z]=[t,i,s]}copy({x:t,y:i,z:s}){[this.x,this.y,this.z]=[t,i,s]}},this.Vector3D=class extends this.Coordinates{constructor({x:t,y:i,z:s,theta:e,phi:h,radius:a}={}){super(t,i,s),null!=t&&null!=i&&null!=s||this.deconposition(e,h,a)}deconposition(t=Math.PI/2,i=Math.PI/4,s=Math.sqrt(2)){this.x=s*Math.sin(t)*Math.cos(i),this.y=s*Math.sin(t)*Math.sin(i),this.z=s*Math.cos(t)}},this.MotionCalculator=class{constructor(i,s){this._parent=t,this.init_vector=new t.Vector3D,this.reference_coordinates=new t.Coordinates,this.current_position=new t.Coordinates,this.time_elapsed,i&&s&&this.init(i,s)}step(){this.current_position.x=this.reference_coordinates.x+this.init_vector.x/this._parent.COFFICIENT_OF_AIR_RESISTANCE*(1-Math.pow(Math.E,-this._parent.COFFICIENT_OF_AIR_RESISTANCE*this.time_elapsed)),this.current_position.y=this.reference_coordinates.y+-this._parent.GRAVITY*this.time_elapsed/this._parent.COFFICIENT_OF_AIR_RESISTANCE+Math.pow(this._parent.COFFICIENT_OF_AIR_RESISTANCE,-2)*(this._parent.GRAVITY+this._parent.COFFICIENT_OF_AIR_RESISTANCE*this.init_vector.y)*(1-Math.pow(Math.E,-this._parent.COFFICIENT_OF_AIR_RESISTANCE*this.time_elapsed)),this.current_position.z=this.reference_coordinates.z+this.init_vector.z/this._parent.COFFICIENT_OF_AIR_RESISTANCE*(1-Math.pow(Math.E,-this._parent.COFFICIENT_OF_AIR_RESISTANCE*this.time_elapsed)),this.time_elapsed+=this._parent.STEP_INTERVAL}init(t,i){this.init_vector.copy(t),this.reference_coordinates.copy(i),this.current_position.copy(i),this.time_elapsed=0}},this.FireParticle=class extends PIXI.Sprite{constructor(i){super(t.sparks),this._parent=t,this.anchor.set(.5),this.highlight=new PIXI.Sprite(t.sparks),this.highlight.anchor.set(.5),this.highlight.tint=16777215,this.life=t.SPARK_TIME*(FIREWORKS.rand_range(93,101)/100),this.appear_time,this.is_appear,this.set_scale(i),this.motion_calculator=new t.MotionCalculator,t.container.addChild(this),t.container.addChild(this.highlight)}step(){performance.now()-this.appear_time>this.life&&this.is_appear&&this.disappear(),this.motion_calculator.step(),this.set_position(this.motion_calculator.current_position)}init_orbit(t,i){this.motion_calculator.init(t,i),this.set_position(i)}set_scale(t){const i=this._parent.SPARKS_RADIUS*t*2/this.texture.width;this.scale.set(i),this.highlight.scale.set(.6*i)}set_position(t){this.position.set(t.x,t.y),this.highlight.position.set(t.x,t.y)}disappear(){this.alpha=0,this.highlight.alpha=0,this.is_appear=!1}appear(){this.alpha=1,this.highlight.alpha=1,this.is_appear=!0,this.appear_time=performance.now()}},this.FireLauncher=class extends this.FireParticle{constructor(){super(1),this._parent=t,this.life=1e5,this.start_point=new t.Coordinates,this.init()}init(){this.start_point.y=this._parent.H,this.start_point.x=FIREWORKS.rand_range(.1*this._parent.W,.9*this._parent.W),this.init_orbit(new this._parent.Vector3D({theta:this._parent.PI_HALF,phi:-this._parent.PI_HALF,radius:FIREWORKS.rand_range(this._parent.LAUNCH_VELOCITY,2.5*this._parent.LAUNCH_VELOCITY)}),this.start_point)}},this.Stars=class{constructor(i){this._parent=t,this.center=new t.Coordinates,this.velocity_random_rate=FIREWORKS.rand_range(70,111)/100,this.reduction_rate=i?.7:1,this.stars=[...Array(t.SPARKS_NUM_PER_FIREWORK)].map(()=>new t.FireParticle(this.reduction_rate))}init(t){this.velocity_random_rate=FIREWORKS.rand_range(70,111)/100,this.center.copy(t),this.place_stars_in_hemisphere()}burst(){for(let t=0,i=this.stars.length;t<i;t++)this.stars[t].step()}place_stars_in_hemisphere(){const t=FIREWORKS.rand_range(0,16777215);let i,s,e,h,a=0,r=Math.random();for(;a<this._parent.SPARKS_NUM_PER_FIREWORK;)e=Math.acos(1-r/this._parent.SPARKS_NUM_PER_FIREWORK),i=FIREWORKS.rand_range(399,402)/400,e>this._parent.PI_HALF?r+=i:(h=this._parent.GOLDEN_SPIRAL*r,(s=this.stars[a]).init_orbit(new this._parent.Vector3D({theta:e,phi:h,radius:this._parent.VELOCITY*this.velocity_random_rate*this.reduction_rate}),this.center),s.tint=t,r+=i,a++)}appear(){for(let t=0,i=this.stars.length;t<i;t++)this.stars[t].appear()}disappear(){for(let t=0,i=this.stars.length;t<i;t++)this.stars[t].disappear()}},this.Firework=class{constructor(){this._parent=t,this.launcher=new t.FireLauncher,this.stars=new t.Stars(!1),this.stars.disappear(),this.sub_stars=new t.Stars(!0),this.sub_stars.disappear(),this.last_launcher_position,this.burst_start_time,this.sleep_start_time,this.sleep_time,this.update=this.launch,this.make_sublayer_burst=!1}launch(){this.last_launcher_position<this.launcher.y?this.switch_launch2burst():(this.last_launcher_position=this.launcher.y,this.launcher.step())}burst(){performance.now()-this.burst_start_time>this._parent.SPARK_TIME?this.switch_burst2sleep():(this.stars.burst(),this.sub_stars.burst())}sleep(){performance.now()-this.sleep_start_time>this.sleep_time&&this.switch_sleep2launch()}switch_launch2burst(){this.launcher.disappear(),this.make_sublayer_burst=FIREWORKS.rand_range(0,2),this.stars.init(this.launcher),this.stars.appear(),this.sub_stars.init(this.launcher),this.make_sublayer_burst&&this.sub_stars.appear(),this.burst_start_time=performance.now(),this.update=this.burst}switch_burst2sleep(){this.stars.disappear(),this.sub_stars.disappear(),this.sleep_time=FIREWORKS.rand_range(0,this._parent.SLEEP_TIME),this.sleep_start_time=performance.now(),this.update=this.sleep}switch_sleep2launch(){this.last_launcher_position=this._parent.H,this.launcher.init(),this.launcher.appear(),this.update=this.launch}}}static rand_range(t,i){return Math.floor(Math.random()*Math.floor(i-t))+t}static set_full_screen(){const t=document.createElement("style"),i=document.createTextNode("*{margin:0;padding:0;}html{height:100%;}body{width:100%;height:100%;}canvas{position:absolute;top:0;left:0;}");t.media="screen",t.type="text/css",t.appendChild(i),document.getElementsByTagName("head").item(0).appendChild(t)}}